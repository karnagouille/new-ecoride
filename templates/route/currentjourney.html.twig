{% extends 'base.html.twig' %}

{% block title %}Covoiturage
{% endblock %}

{% block body %}


	{% block stylesheets %}
		{{ parent() }}
		<link rel="stylesheet" href="{{ asset('css/style.css') }}">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
		<script src="{{ asset('script/main.js') }}" defer></script>
	{% endblock %}
	<header>
		<nav class="container titleshadow">
			<div>
				<a href="{{ path('home') }}" class="decoration navlink">Accueil</a>
			</div>
			<div>
				<a href="{{ path('searchcarpool') }}" class="decoration navlink">Covoiturage</a>
			</div>
			<div>
				<a href="#" class="decoration navlink">Contact</a>
			</div>
			<div>
				<a href="{{ path('myaccount') }}" class="decoration navlink">Mon compte</a>
			</div>

			{% if app.user %}
				<div>
					<a href="{{ path('app_logout') }}" class="decoration navlink">DÃ©connexion</a>
				</div>
			{% else %}
				<div>
					<a href="{{ path('app_login') }}" class="decoration navlink">Connexion</a>
				</div>
			{% endif %}
		</nav>
	</header>

	<div class="userprofil">
		<div class="mainuser">
			<div>
				<p>
					<strong>{{user.pseudo}}</strong>
				</p>
			</div>
			<div>
				<img src="/ecoridee/image/voiturier.jpg" alt="" class="userimg">
			</div>
			<div>
				<p>
					<strong>{{user.lastname}}{{user.name}}</strong>
				</p>
			</div>
			<div>
				<p>
					<strong>{{user.email}}</strong>
				</p>
			</div>
		</div>
		<div class="historical2">
			<div>
				<p>
					<strong>
						<u>Trajets en cours</u>
					</strong>
				</p>
			</div>

			{% for t in trajets %}
			{% set transaction = t.creditTransactions.first %}
				{% if t.statut == 'rien' or t.statut == 'en_cours'%}
					<div class="historicals">

						<div href="/ecoridee/HTML/renseignement.html" class="reserved">
							<div class="backgroundhistorical">
								<div class="profilhistorical">
									<a href="{{ path('renseignement', {'id': t.id}) }}"><img class="picturesprofil" src="{{ asset('uploads/' ~ t.user.photo) }}" alt="Photo de profil" ></a>
									<div class="destination">
										<div>
											<div>
												<div>
													<p>
														<strong>{{ t.startAt|date('d/m/Y') }}
														</strong>
													</p>
												</div>

												<div>
													<p>
														<strong>DurÃ©e environ
															{{ t.traveltime }}
															H
														</strong>
													</p>
												</div>
											</div>
											<div class="startfinish">

												<div>
													<p>
														<strong>ğŸ DÃ©part ğŸ{{ t.startTown }}</strong>
													</p>
												</div>
											</div>

											<div>------------------------------------------------------------</div>
											<div class="startfinish">
												<div>
													<p>
														<strong>ğŸ¯ ArrivÃ©e ğŸ¯:
															{{ t.endTown }}</strong>
													</p>
												</div>
											</div>
										</div>
									</div>

									<div class="priceplacehistorical">
										<div>
											<p>
												<strong>{{ t.hour ? t.hour|date('H:i') : '' }}
												</strong>
											</p>
										</div>
										<div>
											<p>
												<strong>{{ t.passenger }}
													Passager</strong>
											</p>
										</div>
										<div>
											<p>
												<strong>{{ transaction ? transaction.amount : 'Non dÃ©fini' }}â‚¬</strong>
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					{% if app.user.id == t.user.id %}
					<form method="post" action="{{ path('change_statut', {'id': t.id}) }}">
					<input type="hidden" name="_token" value="{{ csrf_token('change_statut' ~ t.id) }}">

						<button type="submit">{% if t.statut == 'rien' or t.statut is null %} DÃ©marrer {% else %} ArrivÃ©e {% endif %}
    </button>
					</form>
					{% endif %}
					
    <form method="post" action="{{ path('annulation', {'id': t.id}) }}">
        <button type="submit">Annuler</button>
    </form>


			{% endif %}
			{% endfor %}
			</div>
</div>
{% endblock %}
